<div class="past-orders-container">
  <div class="past-orders-content">
    <h2>Your Past Orders</h2>

    <div *ngIf="getObjectKeys(groupedOrders).length === 0 && !isLoadingInitial" class="no-data-message">
      ðŸ“¦ No past orders found!
    </div>

    <div *ngIf="isLoadingInitial" class="loading-message">
      ðŸ”„ Loading past orders...
    </div>

    <mat-accordion>
      <mat-expansion-panel *ngFor="let date of getObjectKeys(groupedOrders)" (opened)="onPanelOpened(date)">
        <mat-expansion-panel-header>
          <mat-panel-title>{{ date }}</mat-panel-title>
        </mat-expansion-panel-header>

        <div *ngIf="loadingStates[date]; else loadedContent" class="loading-content">
          <div class="loading-spinner">
            <mat-spinner diameter="30"></mat-spinner>
            <span>Loading orders...</span>
          </div>
        </div>

        <ng-template #loadedContent>
          <mat-card class="orders-card" *ngIf="groupedOrders[date] && groupedOrders[date].length > 0">
            <mat-card-content>
              <table mat-table [dataSource]="groupedOrders[date]" class="orders-table">

                <!-- Order ID Column -->
                <ng-container matColumnDef="orderId">
                  <th mat-header-cell *matHeaderCellDef>Order ID</th>
                  <td mat-cell *matCellDef="let item">
                    <div class="order-id-cell">
                      {{ item.orderId }}
                    </div>
                  </td>
                </ng-container>

                <!-- Product Column -->
                <ng-container matColumnDef="product">
                  <th mat-header-cell *matHeaderCellDef>Product</th>
                  <td mat-cell *matCellDef="let item">
                    <div class="product-info">
                      <img [src]="item.imageUrl || 'assets/comingsoon.jpg'" class="product-image" alt="{{ item.productName || 'Product' }}" />
                      <div class="product-details">
                        <div class="product-name" matTooltip="{{ item.productName || 'Unknown Product' }}">
                          {{ item.productName || 'Unknown Product' }}
                        </div>
                        <div class="product-meta">
                          SIZE: {{ item.size || 'XX' }} | Brand: {{ item.brand || 'Unknown' }}
                        </div>
                      </div>
                    </div>
                  </td>
                </ng-container>

                <!-- Quantity Column -->
                <ng-container matColumnDef="quantity">
                  <th mat-header-cell *matHeaderCellDef>Quantity</th>
                  <td mat-cell *matCellDef="let item">
                    {{ item.quantity }}
                  </td>
                </ng-container>

                <!-- Price Column -->
                <ng-container matColumnDef="price">
                  <th mat-header-cell *matHeaderCellDef>Price</th>
                  <td mat-cell *matCellDef="let item">
                    <div class="price-info">
                      <div class="current-price">â‚¹{{ item.price || 0 }}</div>
                      <div class="discounted-price">â‚¹{{ item.discountedPrice || item.price || 0 }} each</div>
                    </div>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </mat-card-content>
          </mat-card>
        </ng-template>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
